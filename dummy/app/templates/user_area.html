{% extends 'base.html' %}
{% load static %}

{% block title %}Área do Usuário - e-Saving{% endblock %}

{% block styles %}
    <link rel="stylesheet" href="{% static 'esaving/css/layout2.css' %}" />
    <style>
        /* Ajustes rápidos para a grid do perfil */
        .grid { display: flex; flex-direction: column; align-items: center; padding: 20px; }
        .widelist { list-style: none; padding: 0; display: flex; gap: 50px; justify-content: center; }
        .widelist-item { display: flex; align-items: center; gap: 15px; }
        .widelist-img { width: 60px; }
        .content-section { background: white; padding: 30px; border-radius: 20px; width: 100%; max-width: 800px; margin-bottom: 30px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .section-subtitle-bold { color: #77B255; text-align: center; margin-bottom: 20px; }
        .edit-button { cursor: pointer; float: right; }
        .edit-button img { width: 30px; }
    </style>
{% endblock %}

{% block content %}
<div class="grid">
    <h2 class="section-subtitle-bold">Olá, {{ user.name }}</h2>

    <section class="content-section">
        <h2 class="section-subtitle-bold">Resumo</h2>
        <ul class="widelist">
            <li class="widelist-item">
                <img src="{% static 'esaving/images/coroa.png' %}" alt="Pontos" class="widelist-img">
                <div class="widelist-text-container">
                    <h4 class="widelist-small">Pontos</h4>
                    <h3 class="widelist-label">{{ user.points|default:"0" }}</h3>
                </div>
            </li>
            <li class="widelist-item">
                <img src="{% static 'esaving/images/cubo.png' %}" alt="Itens" class="widelist-img">
                <div class="widelist-text-container">
                    <h4 class="widelist-small">Itens descartados</h4>
                    <h3 class="widelist-label">{{ user.discarded_items|default:"0" }}</h3>
                </div>
            </li>
        </ul>
    </section>

    <section class="content-section">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h2 class="section-subtitle-bold mb-0">Informações de cadastro</h2>
            <div class="edit-button" onclick="editToggle()" title="Editar dados">
                <img src="{% static 'esaving/images/editar.png' %}" alt="Editar">
            </div>
        </div>

        <form method="post" action="{% url 'update_user' %}" class="generic-form">
            {% csrf_token %}
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">Nome</label>
                    <input class="form-control form-input" type="text" name="name" value="{{ user.name }}" disabled required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Email</label>
                    <input class="form-control form-input" type="email" name="email" value="{{ user.email }}" disabled required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">CPF</label>
                    <input class="form-control form-input" type="text" name="cpf" id="cpfCliente" value="{{ user.cpf }}" disabled required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Telefone</label>
                    <input class="form-control form-input" type="text" name="phone" id="telefone" value="{{ user.phone }}" disabled required>
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label class="form-label">CEP</label>
                    <input class="form-control form-input" type="text" name="zip_code" id="cepCliente" value="{{ user.zip_code }}" disabled required>
                </div>
                <div class="col-md-6 mb-3">
                    <label class="form-label">Senha (Numérica)</label>
                    <input class="form-control form-input" type="password" name="password" value="{{ user.password }}" disabled required>
                </div>
            </div>

            <div class="text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg form-submit" style="display: none;">Confirmar Alterações</button>
            </div>
        </form>
    </section>

    <section class="mt-4">
        <form action="{% url 'delete_user' %}" method="post" onsubmit="return confirm('Tem certeza que deseja excluir sua conta? Esta ação não pode ser desfeita.');">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger" id="delete">Apagar cadastro</button>
        </form>
    </section>
</div>
{% endblock %}

{% block scripts %}
    <script src="{% static 'esaving/js/enableForm.js' %}"></script>
    <script src="{% static 'esaving/js/cpf.js' %}"></script>
    <script>
        // Pequeno script inline para garantir que o botão apareça ao editar
        // Já que o enableForm.js original pode ter lógica específica de seletores
        function editToggle() {
            const inputs = document.querySelectorAll('.form-input');
            const submitBtn = document.querySelector('.form-submit');
            
            inputs.forEach(input => {
                input.disabled = !input.disabled;
            });
            
            if (submitBtn.style.display === 'none') {
                submitBtn.style.display = 'inline-block';
            } else {
                submitBtn.style.display = 'none';
            }
        }
    </script>
{% endblock %}
